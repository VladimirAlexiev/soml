#+TITLE: soml-simplify
#+STARTUP: nonum

* Intro
The purpose of this script is to simplify a SOML entity schema, so it can be communicated more easily to LLM for querying (NLQ to GraphQL).

Note: we need to preserve abstract classes (interfaces) because:
- This saves on the description of common props.
  We don't expand ~props~ inherited from superclasses, but hope that LLM can track this 
- Sometimes the range of a prop is an abstract class

A draft script was made by GPT-4 following the specfication below, then improved by me.
  
* Specification
- Make a perl script ~soml-simplify.pl~ to simplify a YAML object schema, as shown in the Examples below
- Give me only code, not any explanations
- Use an appropriate CPAN module like ~YAML~ or ~YAML::PP~
- Use ~properties~ to collect global prop characteristics, then combine with per-object ~props~ definitions
- Render only ~objects~, skip all other major sections
- Render ~inherits, props, range~ directly, not as YAML sub-objects
- The default ~range~ is ~string~
- The default is ~max: 1~. If a prop has a greater max cardinality, show it as array: ~[...]~
- Omit descriptions and other characteristics
** Example Source 
#+begin_src yaml
objects:
  AccumulatorReset:
    descr: This command reset the counter value to zero
    inherits: ControlInterface
    label: AccumulatorReset
    props:
      accumulatorReset.AccumulatorValue: {}
    type: cim:AccumulatorReset
  ControlInterface:
    descr: Abstract superclass of Control
    inherits: IdentifiedObjectInterface
    kind: abstract
    search: {nested: true}
    props:
      control.PowerSystemResource: {}
properties:
  accumulatorReset.AccumulatorValue:
    descr: The accumulator value that is reset by the command
    inverseOf: accumulatorValue.AccumulatorReset
    kind: object
    label: AccumulatorValue
    max: 1
    min: 1
    range: AccumulatorValue
    rdfProp: cim:AccumulatorReset.AccumulatorValue
  control.PowerSystemResource:
    descr: 'The controller outputs used to...'
    inverseOf: powerSystemResource.Controls
    kind: object
    label: PowerSystemResource
    max: inf
    min: 0
    range: PowerSystemResourceInterface
    rdfProp: cim:Control.PowerSystemResource
#+end_src
** Example Target
#+begin_src yaml
   AccumulatorReset:
     ISA: ControlInterface
     accumulatorReset.AccumulatorValue: AccumulatorValue
   ControlInterface:
     ISA: IdentifiedObjectInterface
     control.PowerSystemResource: [PowerSystemResourceInterface]
#+end_src
