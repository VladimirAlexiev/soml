<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Semantic Objects Modeling Language</title>
<meta name="author" content="Vladimir Alexiev" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style> #content {max-width: 120em; margin: auto} h1,h2,h3,h4,h5,h6,h7 {font-family: Arial} .author, .date, .creator {-webkit-margin-before: 0em; -webkit-margin-after: 0em} .abstract {margin: 1em; padding: 1em; border: 1px solid black} .abstract:before {content: 'Abstract: '; font-weight: bold} #preamble p {font-size: 110%%; margin-left: auto; margin-right: auto; text-align: center} th.org-left   {text-align:left} th.org-right  {text-align:right} th.org-center {text-align:center} th, td {line-height: 1em; border-width: 1px; border-style: solid solid; border-spacing: 2px 2px; padding: 2px 1px} .CANCELED {color: blue} .MAYBE {color: blue} .POSTPONED {color: blue} .SAME {color: blue} .APPLIED {color: orange} .FOLLOW {color: orange} .INPROGRESS {color: orange} .NEXT {color: orange} .IER {color: orange}.underline {text-decoration:underline} </style>
</head>
<body>
<div id="preamble" class="status">
<p class="author">Author: Vladimir Alexiev (<a href="mailto:vladimir.alexiev@ontotext.com">vladimir.alexiev@ontotext.com</a>)</p>
<p class="date">Date: 2024-10-14</p>
</div>
<div id="content" class="content">
<h1 class="title">Semantic Objects Modeling Language</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#intro">Intro</a>
<ul>
<li><a href="#why-soml">Why SOML?</a></li>
<li><a href="#similar-schema-languages">Similar Schema Languages</a></li>
<li><a href="#what-is-soml">What is SOML</a></li>
</ul>
</li>
<li><a href="#complex-schema-company-graph">Complex Schema (Company Graph)</a>
<ul>
<li><a href="#example-class">Example Class</a></li>
<li><a href="#example-inverse-alias">Example Inverse Alias</a></li>
<li><a href="#example-diagram-exchange-listing-soml">Example Diagram: Exchange Listing SOML</a></li>
<li><a href="#example-diagram-exchange-listing-rdf">Example Diagram: Exchange Listing RDF</a></li>
</ul>
</li>
<li><a href="#soml-tooling">SOML Tooling</a>
<ul>
<li><a href="#owl2soml">owl2soml</a></li>
<li><a href="#tsv2soml">tsv2soml</a>
<ul>
<li><a href="#reusing-property-characteristics">Reusing Property Characteristics</a></li>
</ul>
</li>
<li><a href="#soml-map">soml-map</a></li>
<li><a href="#soml-simplify">soml-simplify</a>
<ul>
<li><a href="#example-source-soml-schema">Example Source (SOML schema)</a></li>
<li><a href="#example-target-simplified">Example Target (Simplified)</a></li>
</ul>
</li>
<li><a href="#tsv2owl">tsv2owl</a>
<ul>
<li><a href="#ontology-preamble">Ontology Preamble</a></li>
<li><a href="#tsv2owl-options">tsv2owl Options</a></li>
<li><a href="#tsv2owl-columns-and-features">tsv2owl Columns and Features</a></li>
<li><a href="#rdf-replacement">RDF Replacement</a></li>
<li><a href="#running-tsv2owl">Running tsv2owl</a></li>
</ul>
</li>
<li><a href="#soml2puml">soml2puml</a></li>
</ul>
</li>
<li><a href="#tricky-points-and-deficiencies">Tricky Points and Deficiencies</a>
<ul>
<li><a href="#graphql-type-vs-rdf-type">GraphQL Type vs rdf:type</a></li>
<li><a href="#single-vs-multiple-value-props">Single vs Multiple-Value Props</a></li>
<li><a href="#inverse-aliases">Inverse Aliases</a></li>
<li><a href="#literals">Literals</a></li>
<li><a href="#extended-pattern-prefix-regex">Extended Pattern (Prefix + Regex)</a></li>
<li><a href="#iri-generation">IRI Generation</a></li>
<li><a href="#schema-inclusion-modularity">Schema Inclusion/Modularity</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
(You can read this <a href="https://github.com/VladimirAlexiev/soml/">rendered by github</a> or <a href="https://rawgit2.com/VladimirAlexiev/soml/master/README.html">rendered as HTML</a>)
</p>

<div id="outline-container-intro" class="outline-2">
<h2 id="intro">Intro</h2>
<div class="outline-text-2" id="text-intro">
<p>
The Semantic Objects Modeling Language (SOML)
is a simple YAML-based language for describing business objects (business entities, domain objects) 
that are handled using semantic technologies and GraphQL.
SOML is the language of the Ontotext Platform.
</p>

<p>
The Ontotext Platform helps create knowledge graphs in an easier way,
both using and enabling text analytics to interlink and enrich knowledge graphs,
and enabling better search, exploration, classification, and recommendation across diverse information spaces.
</p>

<p>
Version 3.0 of the Platform was released at the end of 2019 and is under active develoment and evolution.
</p>
<ul class="org-ul">
<li>It is documented at <a href="http://platform.ontotext.com/">http://platform.ontotext.com/</a>, including:
<ul class="org-ul">
<li><a href="http://platform.ontotext.com/semantic-objects/semantic-objects.html">Semantic Objects as a Service (SOaaS)</a></li>
<li><a href="http://platform.ontotext.com/soml/index.html">Semantic Objects Modeling Language (SOML)</a></li>
<li><a href="http://platform.ontotext.com/tutorials/soaas-tutorial.html">SOaaS Tutorial</a></li>
</ul></li>
<li>The blog post <a href="https://www.ontotext.com/blog/the-rise-of-the-knowledge-graph/">A New Hope: The Rise of the Knowledge Graph</a> 
(Navigating through the Star Wars universe with knowledge graphs, SPARQL and GraphQL),
6 December 2019
introduces the platform, 
compares RDF and GraphQL representations of a domain (Star Wars),
and shows interactive GraphQL queries.</li>
</ul>

<p>
This blog goes in-depth on SOML: 
motivates the use of SOML, 
describes some tricky points of SOML usage and GraphQL deficiencies,
and introduces some SOML tooling for 
generating SOML (<code>tsv2soml</code>) and mapping RDF data (<code>soml-map</code>)
</p>
</div>

<div id="outline-container-why-soml" class="outline-3">
<h3 id="why-soml">Why SOML?</h3>
<div class="outline-text-3" id="text-why-soml">
<p>
We often are asked why we had to introduce yet another object modeling language?
Why didn't we use existing semantic web mechanisms such as 
ontologies (RDFS or OWL) or shapes (SHACL or SHEX),
or schema mechanisms such as GraphQL schema, JSON schema and the like?
The answer is multi-fold:
</p>
<dl class="org-dl">
<dt>Semantic models are more than ontologies</dt><dd>Every sizable semantic project (and many LOD datasets) use a number of ontologies together.
While ontologies describe the vocabulary of classes and properties to use,
extra mechanisms are required to describe how these elements are put together,
and what are the data expectations about different kinds of nodes in the graph.
One could do some of that with ontologies, 
e.g. use OWL property cardinalities, 
complex OWL classes to define polymorphic domains and ranges,
and XSD datatype constructions to describe literal patterns.
However, the inferential rather than validation semantics of RDFS and OWL 
and their inherent complexity 
have led people to use application profiles and RDF shapes instead.</dd>
<dt>Lack of standardization</dt><dd>While there are several implementations of GraphQL querying over RDF,
each of them does it in a different way and there is no standardization.
The <a href="https://www.topquadrant.com/graphql/graphql-shacl.html">TopQuadrant GraphQL to SHACL</a> mapping comes close to using 
SHACL for generating GraphQL schemas, but still uses custom extensions.
Definitive mappings between SHACL and SHEX are not available.
The <a href="https://www.w3.org/community/graphql-rdf/">Bridging GraphQL and RDF</a> W3C Community Group has been launched (Jan 2020)
with the mission to close this gap,
and hopefully define standard mappings/crosswalks between SHACL, SHEX and 
GraphQL schemas and validation mechanisms.
We plan to participate actively in this group.</dd>
<dt>Freedom to innovate</dt><dd>Our ambition is for the Ontotext platform to cover a wide variety of enterprise features.
To be able to develop them at our own pace, we need a language where we can add such innovations.
Examples include
data validation based on RDF shapes (generated from SOML);
Role-Based Access Control (RBAC);
faceting, autocompletion and full-text search;
aggregation;
distribution of data to various stores through GraphDB Connectors and/or GraphQL Federation.</dd>
<dt>Technology independence</dt><dd>Flowing from the previous reason, we'd like SOML to be technology-independent to some degree.
While we don't aim for a theoretical develpment that lives in a technological vacuum,
we need to be able to generate a number of technical artefacts from the same business-level model.</dd>
</dl>
</div>
</div>

<div id="outline-container-similar-schema-languages" class="outline-3">
<h3 id="similar-schema-languages">Similar Schema Languages</h3>
<div class="outline-text-3" id="text-similar-schema-languages">
<p>
A number of schema languages have appeared recently that are based on YAML,
express business-level object models that are somewhat independent of technological choices,
and can render the models to a variety of schema technologies:
</p>

<ul class="org-ul">
<li><a href="https://biolink.github.io/biolinkml/">BioLink modeling language</a>.
Models are authored in YAML. A variety of artefacts can be generated, including SHEX, JSON-Schema, OWL, Python dataclasses, ElasticSearch type definitions, 
UML diagrams, Markdown pages for deployment in a GitHub pages site, etc.</li>
<li><a href="https://www.hl7.org/fhir/">HL7 FHIR</a>, which is a business-level language for expressing Health Care models 
and has renditions in UML, XML, JSON, Turtle, SHEX.</li>
<li><b>a.ml</b>: <a href="https://a.ml/">Anything Modeling Language</a> (see <a href="https://a.ml/docbook/">documentation</a>, <a href="https://a.ml/aml-spec/vocabularies/">vocabularies</a>, <a href="https://a.ml/aml-spec/dialects/">dialects</a>),
which targets mapping of YAML schemas to ontologies and SHACL shapes, 
and YAML documents to RDF graphs.</li>
<li><a href="https://cloudinformationmodel.org/about.html">Cloud Information Model (CIM)</a>, which targets
AML Vocabulary (conceptual model),
AML Dialect (data shapes),
RDFS (entities and relationships),
SHACL (data shapes and constraints),
SQL DDL (relational database schema),
R2RML (mapping from relational schema to RDF),
RAML (REST API data types),
JSON Schema (data shapes)</li>
<li>The Uber Graph Schema Language, a YAML language that is
used to generate various artefacts (ProtoBuf, Avro, RDFS ontology, etc) 
and to integrate <b>200 thousand</b> datasets at Uber.
While not publically available, it's described in presentations by <a href="https://www.slideshare.net/joshsh">Joshua Shinavier</a> including:
<ul class="org-ul">
<li><a href="https://www.slideshare.net/joshsh/a-graph-is-a-graph-is-a-graph-equivalence-transformation-and-composition-of-graph-data-models-129403012/1">A Graph is a Graph is a Graph: Equivalence, Transformation, and Composition of Graph Data Models</a> (Jan 2019).</li>
<li><a href="https://www.slideshare.net/joshsh/building-an-enterprise-knowledge-graph-uber-lessons-from-reality">Building an Enterprise Knowledge Graph @Uber: Lessons from Reality</a> (May 2019)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-what-is-soml" class="outline-3">
<h3 id="what-is-soml">What is SOML</h3>
<div class="outline-text-3" id="text-what-is-soml">
<p>
At present SOML is very simple, but will evolve to include more features.
The overall structure of a SOML file (schema) is shown below.
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #b22222;"># </span><span style="color: #b22222;">comment</span>
<span style="color: #a0522d;">id</span>:          /soml/&lt;identifier&gt;
<span style="color: #a0522d;">label</span>:       some name
<span style="color: #a0522d;">created</span>:     yyyy-mm-dd
<span style="color: #a0522d;">updated</span>:     yyyy-mm-dd
<span style="color: #a0522d;">creator</span>:     name and/or URL
<span style="color: #a0522d;">versionInfo</span>: version

<span style="color: #b22222;"># </span><span style="color: #b22222;">comment</span>
<span style="color: #a0522d;">specialPrefixes</span>:
  <span style="color: #a0522d;">base_iri</span>:     &lt;base&gt;
  <span style="color: #a0522d;">vocab_iri</span>:    &lt;vocab&gt;
  <span style="color: #a0522d;">vocab_prefix</span>: &lt;voc&gt;
  <span style="color: #a0522d;">ontology_iri</span>: &lt;ontology&gt;
  <span style="color: #a0522d;">shape_iri</span>:    &lt;shape&gt;
<span style="color: #a0522d;">prefixes</span>:
  <span style="color: #a0522d;">&lt;pfx&gt;</span>:        &lt;namespace&gt;

<span style="color: #b22222;"># </span><span style="color: #b22222;">datatypes</span>
<span style="color: #a0522d;">types</span>:
  <span style="color: #a0522d;">&lt;type&gt;</span>:       {<span style="color: #a0522d;">rdf</span>: &lt;xsd-type&gt;,    <span style="color: #a0522d;">graphql</span>: &lt;GQL-type&gt;, <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"..."</span>, <span style="color: #a0522d;">graphqlExtension</span>: &lt;boolean&gt;}
  <span style="color: #a0522d;">&lt;union-type&gt;</span>: {<span style="color: #a0522d;">union</span>: [&lt;type&gt;...], <span style="color: #a0522d;">graphql</span>: &lt;GQL-type&gt;, <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"..."</span>}

<span style="color: #b22222;"># </span><span style="color: #b22222;">common property definitions</span>
<span style="color: #a0522d;">properties</span>:
  <span style="color: #a0522d;">&lt;prop&gt;</span>:  {<span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"..."</span>, <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"..."</span>, <span style="color: #a0522d;">range</span>: &lt;datatype|Obj&gt;, <span style="color: #a0522d;">rangeCheck</span>: &lt;boolean&gt;, <span style="color: #a0522d;">typeCast</span>: &lt;boolean&gt;,
            <span style="color: #a0522d;">kind</span>: (object|literal|mixed), <span style="color: #a0522d;">min</span>: &lt;default 0&gt;, <span style="color: #a0522d;">max</span>: &lt;default 1&gt;,
            <span style="color: #a0522d;">inverseAlias</span>: &lt;prop&gt;, <span style="color: #a0522d;">inverse</span>: &lt;prop&gt;, <span style="color: #a0522d;">rdfProp</span>: pfx:prop, <span style="color: #a0522d;">symmetric</span>: &lt;boolean&gt;, <span style="color: #a0522d;">regex</span>: <span style="color: #8b2252;">'&lt;regex&gt;'</span>, <span style="color: #a0522d;">prefix</span>: <span style="color: #8b2252;">"&lt;string&gt;"</span>}

<span style="color: #b22222;"># </span><span style="color: #b22222;">object class definitions</span>
<span style="color: #a0522d;">objects</span>:
  <span style="color: #a0522d;">&lt;Obj&gt;</span>:  {<span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"..."</span>, <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"..."</span>, <span style="color: #a0522d;">regex</span>: <span style="color: #8b2252;">'&lt;regex&gt;'</span>, <span style="color: #a0522d;">prefix</span>: <span style="color: #8b2252;">"&lt;string&gt;"</span>,
           <span style="color: #a0522d;">typeProp</span>: &lt;prop&gt;, <span style="color: #a0522d;">type</span>: [&lt;iri&gt;...], <span style="color: #a0522d;">name</span>: &lt;prop&gt;, <span style="color: #a0522d;">inherits</span>: &lt;Obj&gt;, <span style="color: #a0522d;">kind</span>: (abstract|supertype)}
    <span style="color: #a0522d;">props</span>:
      <span style="color: #a0522d;">&lt;prop&gt;</span>: ...

</pre>
</div>

<p>
From this schema the Platform generates a complex GraphQL schema 
including a fairly complete querying language that allows you to
find any kind of object, filter, order, navigate through the KG, 
and do pagination (limit, offset).
</p>

<p>
You can find details in the <a href="http://platform.ontotext.com/soml/index.html">SOML documentation</a>, while below we describe 
some tricky points of SOML usage and GraphQL deficiencies, and some tooling.
</p>
</div>
</div>
</div>

<div id="outline-container-complex-schema-company-graph" class="outline-2">
<h2 id="complex-schema-company-graph">Complex Schema (Company Graph)</h2>
<div class="outline-text-2" id="text-complex-schema-company-graph">
<p>
To introduce the proper context for this blog (working with complex SOML schemas),
we'll describe the Ontotext Company Graph (ONTO CG) ontology and model.
It's a medium-high complexity data model that reuses 14 ontologies and adds classes and props of its own.
Of its 24 classes and 150 props, about half are reused and half are created especially for CG.
It's fairly typical data model for the kind of projects that Ontotext deals with.
</p>

<p>
Creating the ONTO CG knowledge graph is part of
the <a href="https://www.ontotext.com/cima/">Intelligent Matching and Linking of Company Data (CIMA)</a> research project.
We are integrating data from open and a few proprietary datasets. The emphasis of the project is on financial transactions, industrial classification, company size/importance observations (e.g. annual sales, number of employees), etc.
</p>

<p>
The following table shows the count of classes and properties defined by the ONTO-CG ontology, as well as those reused from other ontologies.
</p>

<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">
<caption class="t-above"><span class="table-number">Table 1:</span> Ontology reuse and extension in Ontotext Company Graph.</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Prefix</th>
<th scope="col" class="org-left">Ontology</th>
<th scope="col" class="org-right">Classes</th>
<th scope="col" class="org-right">Props</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">cg</td>
<td class="org-left">Ontotext Company Graph</td>
<td class="org-right">12</td>
<td class="org-right">70</td>
</tr>

<tr>
<td class="org-left">adms</td>
<td class="org-left">Asset Description Metadata Schema</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">dcat</td>
<td class="org-left">Data Catalog Vocabulary</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">dct</td>
<td class="org-left">Dublin Core Terms</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">ebg</td>
<td class="org-left">euBusinessGraph</td>
<td class="org-right">1</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">gn</td>
<td class="org-left">GeoNames</td>
<td class="org-right">1</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-left">locn</td>
<td class="org-left">W3C Location Ontology</td>
<td class="org-right">1</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">org</td>
<td class="org-left">W3C Core Organization Ontology</td>
<td class="org-right">1</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left">qb</td>
<td class="org-left">W3C Cube Ontology</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">rov</td>
<td class="org-left">W3C Registered Organization</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">schema</td>
<td class="org-left">Schema.org</td>
<td class="org-right">3</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">skos</td>
<td class="org-left">Simple Knowledge Organization System</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-left">time</td>
<td class="org-left">W3C Time Ontology</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">void</td>
<td class="org-left">Vocabulary of Interlinked Datasets</td>
<td class="org-right">1</td>
<td class="org-right">7</td>
</tr>

<tr>
<td class="org-left">wgs84</td>
<td class="org-left">World Geodetic Survey</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">2</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">24</td>
<td class="org-right">150</td>
</tr>
</tbody>
</table>

<p>
ONTO CG builds upon the results of the euBusinessGraph project.
The euBusinessGraph semantic model and dataset covers the following
(we have submitted a description of it to a prominent journal on semantic technologies):
</p>
<ul class="org-ul">
<li>Basic firmography (legal names, preferred name)</li>
<li>Basic person info</li>
<li>Geography, address, hieararchical administrative divisions</li>
<li>Company legal type and status</li>
<li>Industry classification (based on NACE)</li>
<li>Identifiers from Official registers and others</li>
<li>Company officers and directors (positions, using <code>org:Membership</code>)</li>
<li>Datasets, providers, dataset descriptions</li>
</ul>

<p>
ONTO-CG steps on the euBusinessGraph model and adds the following:
</p>

<ul class="org-ul">
<li><code>IdentifierSystems</code>: We extend the euBusinessGraph idea of generalized identifiers to record any kind of potentially useful identification info in a generic way: phone, email, website, blog, logo/image; profile links and identifiers in various external systems such as: Wikidata, DBpedia, Facebook, LinkedIn, Twitter, Youtube, Reddit, Github, CrunchBase, OpenCorporates, Thomson Reuters permid (TR), ISO 10383 Market Identifier Code (MIC); research-oriented identifiers such as CrossRef funder, Microsoft Academic Graph, Global Research Identifier Database (GRID), Research Organization Registry (ROR), Virtual International Authority File (VIAF).</li>
<li><code>cg:StockExchange</code>: a Stock exchange where companies can offer shares or other securities. We record MIC and TR exchange codes as identifiers.</li>
<li><code>cg:Event</code> and <code>cg:EventAppearance</code>: Conference, workshop, meetup, etc where the work of a certain person or company may be highlighted.</li>
<li><code>gn:Feature</code>: While the euBusinessGraph geographic hierarchy is based on EuroStat NUTS and LAU, ONTO-CG uses Geonames locations to implement geographic matching, auto-completion and faceting. We are particularly interested in the 3 levels Country, Region, City that we have defined as particular lists of gn:featureCodes (e.g. Country corresponds to <code>gn:A.PCLI, gn:A.PCLD, gn:A.PCLIX, gn:A.PCLS, gn:A.PCL, gn:A.TERR, gn:A.PCLF</code>).</li>
<li><code>cg:AcademicQualification</code>: Academic degree (completed or not) of a person at a scholl in an academic major.</li>
<li><code>qb:Observation</code>: Statistical or other observation about an object (typically company), such as annual sales, number of employees, etc. May be for a particular year, point in time, or without date (current).</li>
<li><code>cg:Transaction</code>: Financial transaction that gives money to a company in return for shares or other consideration.</li>
<li><code>cg:OrganizationRelation</code>: Relation between two agents. For asymmetric relations we use two fields "agentMinor" (e.g. subsidiary, owned, supplier) and "agentMajor" (e.g. parent, owner, customer); for symmetric relations we use the field "agent" twice. Usually these are Organizations, but "owner" could involve Persons.</li>
<li>Sourcing (provenance) for each node:
<ul class="org-ul">
<li><code>void:Dataset</code>: Dataset as source of entities</li>
<li><code>void:Linkset</code>: Linkset as source of identifiers (links)</li>
<li><code>cg:SourceMatch</code>: Cluster of matched lower-level entities as the source of a higher-level entity.</li>
</ul></li>
</ul>

<p>
In addition to the above new classes, ONTO-CG adds:
</p>
<ul class="org-ul">
<li>A 2-level data model where data from individual datasets sits at a lower (KG-building) level, and after matching and data fusion is promoted at a higher (data consumption) level.</li>
<li>Various extra fields, e.g. <code>cg:geoPrecision</code> "Precision of geo coordinates in meters (e.g. street address or building -&gt; 30.8)" to complement <code>ebg:geoResolution</code> "Resolution of geo coordinates as a categorial value (e.g. building -&gt; <code>&lt;resolution/L9&gt;</code>)"</li>
<li>Various flags, e.g. for Organization (<code>cg:isResearch</code>), Position (<code>cg:isCurrent, cg:isPrimary</code>), AcademicQualification (<code>cg:isCompleted</code>), ExchangeListing, OrganizationRelation (<code>cg:isCurrent</code>)</li>
<li>Business nomenclatures (<code>skos:ConceptScheme</code>): <code>Organization Type, Legal Form, Organization Status, Industry, Investor Type, Geo Coordinate Resolution, Address Type, Observation Type, Gender, Event Type, Event Appearance Type, Position Type, Transaction Type, Relation Type</code></li>
</ul>

<p>
The full CG schema is included: <a href="./schemas/CG.yaml">CG.yaml</a>. Below we show a couple of typical examples.
</p>
</div>

<div id="outline-container-example-class" class="outline-3">
<h3 id="example-class">Example Class</h3>
<div class="outline-text-3" id="text-example-class">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">ExchangeListing</span>:
  <span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"Exchange Listing"</span>
  <span style="color: #a0522d;">inherits</span>: Transaction
  <span style="color: #a0522d;">type</span>: [cg:ExchangeListing]
  <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Public offering (IPO, SPO etc) wheres the company receives money from the wide public, and as a result is listed for trading on an exchange"</span>
  <span style="color: #a0522d;">props</span>:
    <span style="color: #a0522d;">exchange</span>:
      <span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"exchange"</span>
      <span style="color: #a0522d;">range</span>: StockExchange
      <span style="color: #a0522d;">min</span>: 1
      <span style="color: #a0522d;">rdfProp</span>: cg:exchange
      <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Stock exchange"</span>
    <span style="color: #a0522d;">stockSymbol</span>:
      <span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"stock symbol"</span>
      <span style="color: #a0522d;">range</span>: string
      <span style="color: #a0522d;">rdfProp</span>: cg:stockSymbol
      <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Stock symbol (ticker). </span><span style="color: #ff0000; font-weight: bold;">TODO</span><span style="color: #8b2252;">: this should also be represented as an Identifier?"</span>
    <span style="color: #a0522d;">valuation</span>:
      <span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"valuation (MUSD)"</span>
      <span style="color: #a0522d;">range</span>: decimal
      <span style="color: #a0522d;">rdfProp</span>: cg:valuation
      <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Company valuation at IPO in MUSD"</span>
    <span style="color: #a0522d;">valuationLocal</span>:
      <span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"valuation (M local currency)"</span>
      <span style="color: #a0522d;">range</span>: decimal
      <span style="color: #a0522d;">rdfProp</span>: cg:valuationLocal
      <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Company valuation at IPO in millions of local currency"</span>
    <span style="color: #a0522d;">valuationCurrency</span>:
      <span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"valuation currency"</span>
      <span style="color: #a0522d;">range</span>: string
      <span style="color: #a0522d;">rdfProp</span>: cg:valuationCurrency
      <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Currency code of the valuation"</span>
    <span style="color: #a0522d;">dateEnd</span>:
      <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Date delisted or left this exchange"</span>
    <span style="color: #a0522d;">isCurrent</span>:
      <span style="color: #a0522d;">rdfProp</span>: cg:isCurrent
      <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Whether the listing is still effective"</span>
</pre>
</div>

<p>
If you look closely, you may wonder where the range and RDF mapping of <code>dateEnd</code> is defined.
It's in the list of reusable properties:
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">properties</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">reused props</span>
  <span style="color: #a0522d;">dateEnd</span>: {<span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"dateCompleted"</span>, <span style="color: #a0522d;">range</span>: dateOrYearOrMonth, <span style="color: #a0522d;">rdfProp</span>: cg:dateEnd}
</pre>
</div>

<p>
A more appropriate <code>descr</code> is given at the object level, overriding the generic description.
</p>
</div>
</div>

<div id="outline-container-example-inverse-alias" class="outline-3">
<h3 id="example-inverse-alias">Example Inverse Alias</h3>
<div class="outline-text-3" id="text-example-inverse-alias">
<p>
A Position is an associative node between Person and Organization that adds more data (not shown):
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">Position</span>:
  <span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"Position"</span>
  <span style="color: #a0522d;">inherits</span>: BusinessObject
  <span style="color: #a0522d;">type</span>: [org:Membership]
  <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">"Position of a person in an organization, former or current"</span>
  <span style="color: #a0522d;">props</span>:
    <span style="color: #a0522d;">person</span>: {<span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"person"</span>, <span style="color: #a0522d;">range</span>: PersonCommon, <span style="color: #a0522d;">min</span>: 1, <span style="color: #a0522d;">rdfProp</span>: org:member}
    <span style="color: #a0522d;">organization</span>: {<span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"organization"</span>, <span style="color: #a0522d;">range</span>: OrganizationCommon, <span style="color: #a0522d;">min</span>: 1, <span style="color: #a0522d;">rdfProp</span>: org:organization}
</pre>
</div>

<p>
To allow navigation in any direction (not just from Position out, but also in), we add inverse aliases:
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">PersonCommon</span>:
  <span style="color: #a0522d;">props</span>:
    <span style="color: #a0522d;">position</span>: {<span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"position"</span>, <span style="color: #a0522d;">range</span>: Position, <span style="color: #a0522d;">inverseAlias</span>: person}
<span style="color: #a0522d;">OrganizationCommon</span>:
  <span style="color: #a0522d;">props</span>:
    <span style="color: #a0522d;">position</span>: {<span style="color: #a0522d;">label</span>: <span style="color: #8b2252;">"position"</span>, <span style="color: #a0522d;">range</span>: Position, <span style="color: #a0522d;">inverseAlias</span>: organization}
</pre>
</div>
</div>
</div>

<div id="outline-container-example-diagram-exchange-listing-soml" class="outline-3">
<h3 id="example-diagram-exchange-listing-soml">Example Diagram: Exchange Listing SOML</h3>
<div class="outline-text-3" id="text-example-diagram-exchange-listing-soml">
<p>
For example, the figure below shows the stock exchange listing (IPO) of Apple on the Tokyo exchange and NASDAQ, and the listing of Nasdaq Inc (the company) on NASDAQ (the stock exchange).
</p>
<ul class="org-ul">
<li>The data is integrated from Wikidata.</li>
<li>This figure is generated from RDF Turtle using <a href="https://github.com/VladimirAlexiev/rdf2rml">rdfpuml</a> (see V.Alexiev, <a href="http://rawgit2.com/VladimirAlexiev/my/master/pres/20161128-rdfpuml-rdf2rml/index.html">RDF by Example: rdfpuml for True RDF Diagrams, rdf2rml for R2RML Generation</a>, Semantic Web in Libraries (SWIB), Nov 2016.</li>
<li>This version of the diagram uses original SOML (GraphQL) property and class names, i.e. all of them share the same namespace (expressed using the empty) prefix.</li>
<li>It can be considered as a "logical" data model of how data should be queried with GraphQL</li>
</ul>

<p>
<a href="./eg/model-exchange-listing.ttl">./eg/model-exchange-listing.ttl</a>
</p>


<div id="orgc7fc250" class="figure">
<p><img src="./eg/model-exchange-listing.png" alt="model-exchange-listing.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-example-diagram-exchange-listing-rdf" class="outline-3">
<h3 id="example-diagram-exchange-listing-rdf">Example Diagram: Exchange Listing RDF</h3>
<div class="outline-text-3" id="text-example-diagram-exchange-listing-rdf">
<p>
This version of the diagram uses <a href="#soml-map">soml-map</a> to map SOML names to RDF names in specific namespaces.
</p>
<ul class="org-ul">
<li>So this can be considered the "physical" data model of data as it's stored in the semantic database</li>
</ul>

<p>
<a href="./eg/model-exchange-listing-mapped.ttl">./eg/model-exchange-listing-mapped.ttl</a>
</p>


<div id="orgdc71676" class="figure">
<p><img src="./eg/model-exchange-listing-mapped.png" alt="model-exchange-listing-mapped.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-soml-tooling" class="outline-2">
<h2 id="soml-tooling">SOML Tooling</h2>
<div class="outline-text-2" id="text-soml-tooling">
</div>

<div id="outline-container-owl2soml" class="outline-3">
<h3 id="owl2soml">owl2soml</h3>
<div class="outline-text-3" id="text-owl2soml">
<p>
This tool (written in Perl) generates SOML schemas from ontologies (that use RDFS, OWL and/or schema.org constructs).
It handles numerous features and has been integrated in the Ontotext Platform (reimplemented in Java).
See its own README.
</p>
</div>
</div>

<div id="outline-container-tsv2soml" class="outline-3">
<h3 id="tsv2soml">tsv2soml</h3>
<div class="outline-text-3" id="text-tsv2soml">
<p>
Editing large schemas is often easier to do in a table, even when the schema language is simple.
(Also, this enables domain experts to participate in schema authoring, even if only editing the descriptions.)
</p>

<p>
The CG model was not written by hand, it was generated from a TSV (google sheet).
</p>

<p>
The sheet has 300 rows, and the generated SOML is 1176 lines.
Here's the beginning of the sheet:
</p>


<div id="orgc2b8524" class="figure">
<p><img src="./eg/CG-sheet.png" alt="CG-sheet.png" />
</p>
</div>

<p>
Here is the end of the sheet, which exposes various thesauri (<code>ConceptSchemes</code>) 
as distinct business classes
</p>


<div id="org5fae081" class="figure">
<p><img src="./eg/CG-sheet2.png" alt="CG-sheet2.png" />
</p>
</div>

<p>
To generate a SOML schema from the google sheet <a href="https://docs.google.com/spreadsheets/d/1_-bn9Y-9rtysnvKiVus6BkFKXqHhiV4vCjYeiRmb6XU/edit#gid=0">CG-data-model</a>, call it like this:
</p>
<pre class="example">
curl -s "https://docs.google.com/spreadsheets/d/1_-bn9Y-9rtysnvKiVus6BkFKXqHhiV4vCjYeiRmb6XU/export?format=tsv" | perl tsv2soml.pl | cat CG-preamble.yaml - &gt; CG.yaml
</pre>


<p>
Here <a href="./schemas/CG-preamble.yaml">CG-preamble.yaml</a> is some fixed SOML metadata (a header).
</p>

<p>
Options:
</p>
<ul class="org-ul">
<li><code>-p</code>: don't emit <code>pattern</code> (this feature restricts URLs to a certain pattern)</li>
<li><code>-l</code>: downgrade Literals: <code>stringOrLangString, langString</code> -&gt; <code>string</code>, <code>dateOrYearOrMonth</code> -&gt; <code>date</code>.
This can be used to simplify the schema not to use <code>langString</code> and union datatypes</li>
</ul>

<p>
Comment lines start with hash (<code>#</code>) in the first column
</p>
<ul class="org-ul">
<li><code># HEADER</code>: if there is a space after the hash, the first cell is printed surrounded by newlines</li>
<li><code>#commented out</code>: if there is no space, the whole line is skipped</li>
</ul>
</div>

<div id="outline-container-reusing-property-characteristics" class="outline-4">
<h4 id="reusing-property-characteristics">Reusing Property Characteristics</h4>
<div class="outline-text-4" id="text-reusing-property-characteristics">
<ul class="org-ul">
<li>The script counts how many times each prop is used in objects</li>
<li>For props used more than once, the script emits the <b>first occurrence</b> of each prop
in the common <code>properties</code> section:</li>
</ul>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">properties</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">reused props</span>
</pre>
</div>
<ul class="org-ul">
<li>This allows you to omit common details (eg <code>label, descr, range</code>) on subsequent occurrences</li>
<li>But it also means that characteristics given in the first occurrence override the defaults
for subsequent occurrences, which may lead to unintended consequences.</li>
</ul>

<p>
Consider a SOML based on schema.org where we allow multiple <code>sameAs</code> values
(e.g. the item's Wikipedia page, Wikidata entry, Linkedin profile, YouTube profile, etc),
and want the field to be mandatory for <code>Organization</code> but optional for <code>Person</code>.
</p>

<p>
We write the details on the first occurrence and then just mention the prop on the second occurrence:
</p>

<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Class/prop</th>
<th scope="col" class="org-left">label</th>
<th scope="col" class="org-left">Inherits/range</th>
<th scope="col" class="org-left">char</th>
<th scope="col" class="org-left">descr</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Organization</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">sameAs</td>
<td class="org-left">same as</td>
<td class="org-left">iri</td>
<td class="org-left">min: 1, max: inf</td>
<td class="org-left">URL that unambiguously indicates the thing's identity</td>
</tr>

<tr>
<td class="org-left">Person</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">sameAs</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
This results in a SOML like this:
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">objects</span>:
  <span style="color: #a0522d;">Organization</span>:
    <span style="color: #a0522d;">props</span>:
      <span style="color: #a0522d;">sameAs</span>:
        <span style="color: #a0522d;">range</span>: iri
        <span style="color: #a0522d;">min</span>: 1
        <span style="color: #a0522d;">max</span>: inf
        <span style="color: #a0522d;">descr</span>: URL that unambiguously indicates the thing's identity
  <span style="color: #a0522d;">Person</span>:
    <span style="color: #a0522d;">props</span>:
      <span style="color: #a0522d;">sameAs</span>:
<span style="color: #a0522d;">properties</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">reused props</span>
  <span style="color: #a0522d;">sameAs</span>:
    <span style="color: #a0522d;">range</span>: iri
    <span style="color: #a0522d;">min</span>: 1
    <span style="color: #a0522d;">max</span>: inf
    <span style="color: #a0522d;">descr</span>: URL that unambiguously indicates the thing's identity
</pre>
</div>
<p>
The prop characteristics are copied from <code>properties</code> into <code>Person.props</code>,
which means that the default cardinality <code>min: 0</code> is overridden by <code>min: 1</code>,
which doesn't match the requirement "optional for <code>Person</code>".
</p>

<p>
To fix this, you need to specify <code>min: 0</code> explicitly in the <code>Person.sameAs</code> table row.
</p>
</div>
</div>
</div>

<div id="outline-container-soml-map" class="outline-3">
<h3 id="soml-map">soml-map</h3>
<div class="outline-text-3" id="text-soml-map">
<p>
<code>tsv2soml</code> writes out a file <code>soml-map.tsv</code> (see exmaple <a href="./schemas/soml-map.tsv">soml-map.tsv</a>) with columns "class, prop (optional), rdf"
</p>
<ul class="org-ul">
<li>For props without <code>RDF</code> value, it uses the RDF name from the shared first occurrence of the same prop name</li>
</ul>

<p>
It can be used to map from SOML names to RDF names (class/prop URLs) in specific namespaces.
Eg compare <a href="#example-diagram-exchange-listing-soml">Example Diagram: Exchange Listing SOML</a> vs <a href="#example-diagram-exchange-listing-rdf">Example Diagram: Exchange Listing RDF</a>.
</p>

<p>
It can be used to map examples (models) or conversion scripts (TARQL, or SPARQL Update for OpenRefine)
from a "logical" representation using uniform GraphQL names
to a "physical" representaiton using specific RDF names.
</p>

<p>
Usage:
</p>
<pre class="example">
perl soml-map.pl &lt; file.(tarql|ru|ttl) &gt; file-mapped.(tarql|ru|ttl)
</pre>
</div>
</div>

<div id="outline-container-soml-simplify" class="outline-3">
<h3 id="soml-simplify">soml-simplify</h3>
<div class="outline-text-3" id="text-soml-simplify">
<p>
The purpose of this script is to simplify a SOML entity schema significantly,
so it can be communicated more easily to LLM for querying (NLQ to GraphQL).
</p>

<p>
Note: we need to preserve abstract classes (interfaces) because:
</p>
<ul class="org-ul">
<li>This saves on the description of common props.
We don't expand <code>props</code> inherited from superclasses, but hope that LLM can track this</li>
<li>Sometimes the range of a prop is an abstract class</li>
</ul>

<p>
A draft script was made by GPT-4 following the specfication below, then improved by me.
</p>
<ul class="org-ul">
<li>Make a perl script <code>soml-simplify.pl</code> to simplify a YAML object schema, as shown in the Examples below</li>
<li>Give me only code, not any explanations</li>
<li>Use an appropriate CPAN module like <code>YAML</code> or <code>YAML::PP</code></li>
<li>Use <code>properties</code> to collect global prop characteristics, then combine with per-object <code>props</code> definitions</li>
<li>Render only <code>objects</code>, skip all other major sections</li>
<li>Render <code>inherits, props, range</code> directly, not as YAML sub-objects</li>
<li>The default <code>range</code> is <code>string</code></li>
<li>The default is <code>max: 1</code>. If a prop has a greater max cardinality, show it as array: <code>[...]</code></li>
<li>Omit descriptions and other characteristics</li>
</ul>
</div>

<div id="outline-container-example-source-soml-schema" class="outline-4">
<h4 id="example-source-soml-schema">Example Source (SOML schema)</h4>
<div class="outline-text-4" id="text-example-source-soml-schema">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">objects</span>:
  <span style="color: #a0522d;">AccumulatorReset</span>:
    <span style="color: #a0522d;">descr</span>: This command reset the counter value to zero
    <span style="color: #a0522d;">inherits</span>: ControlInterface
    <span style="color: #a0522d;">label</span>: AccumulatorReset
    <span style="color: #a0522d;">props</span>:
      <span style="color: #a0522d;">accumulatorReset.AccumulatorValue</span>: {<span style="color: #a0522d;">}</span>
<span style="color: #a0522d;">    type</span>: cim:AccumulatorReset
  <span style="color: #a0522d;">ControlInterface</span>:
    <span style="color: #a0522d;">descr</span>: Abstract superclass of Control
    <span style="color: #a0522d;">inherits</span>: IdentifiedObjectInterface
    <span style="color: #a0522d;">kind</span>: abstract
    <span style="color: #a0522d;">search</span>: {<span style="color: #a0522d;">nested</span>: <span style="color: #008b8b;">true</span>}
    <span style="color: #a0522d;">props</span>:
      <span style="color: #a0522d;">control.PowerSystemResource</span>: {<span style="color: #a0522d;">}</span>
<span style="color: #a0522d;">properties</span>:
  <span style="color: #a0522d;">accumulatorReset.AccumulatorValue</span>:
    <span style="color: #a0522d;">descr</span>: The accumulator value that is reset by the command
    <span style="color: #a0522d;">inverseOf</span>: accumulatorValue.AccumulatorReset
    <span style="color: #a0522d;">kind</span>: object
    <span style="color: #a0522d;">label</span>: AccumulatorValue
    <span style="color: #a0522d;">max</span>: 1
    <span style="color: #a0522d;">min</span>: 1
    <span style="color: #a0522d;">range</span>: AccumulatorValue
    <span style="color: #a0522d;">rdfProp</span>: cim:AccumulatorReset.AccumulatorValue
  <span style="color: #a0522d;">control.PowerSystemResource</span>:
    <span style="color: #a0522d;">descr</span>: <span style="color: #8b2252;">'The controller outputs used to...'</span>
    <span style="color: #a0522d;">inverseOf</span>: powerSystemResource.Controls
    <span style="color: #a0522d;">kind</span>: object
    <span style="color: #a0522d;">label</span>: PowerSystemResource
    <span style="color: #a0522d;">max</span>: inf
    <span style="color: #a0522d;">min</span>: 0
    <span style="color: #a0522d;">range</span>: PowerSystemResourceInterface
    <span style="color: #a0522d;">rdfProp</span>: cim:Control.PowerSystemResource
</pre>
</div>
</div>
</div>
<div id="outline-container-example-target-simplified" class="outline-4">
<h4 id="example-target-simplified">Example Target (Simplified)</h4>
<div class="outline-text-4" id="text-example-target-simplified">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">AccumulatorReset</span>:
  <span style="color: #a0522d;">ISA</span>: ControlInterface
  <span style="color: #a0522d;">accumulatorReset.AccumulatorValue</span>: AccumulatorValue
<span style="color: #a0522d;">ControlInterface</span>:
  <span style="color: #a0522d;">ISA</span>: IdentifiedObjectInterface
  <span style="color: #a0522d;">control.PowerSystemResource</span>: [PowerSystemResourceInterface]
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-tsv2owl" class="outline-3">
<h3 id="tsv2owl">tsv2owl</h3>
<div class="outline-text-3" id="text-tsv2owl">
<p>
This tool uses the same sheets that drive <code>tsv2soml</code> to generate an OWL ontology.
It works like this:
</p>
<ul class="org-ul">
<li>Generates term definitions from the sheet</li>
<li>Prepends a preamble</li>
<li>Formats the result with Jena <code>riot</code> or <code>update</code></li>
<li>Sorts the file by term (Turtle block: such "paragraphs" are separated by a double newline)</li>
</ul>
</div>

<div id="outline-container-ontology-preamble" class="outline-4">
<h4 id="ontology-preamble">Ontology Preamble</h4>
<div class="outline-text-4" id="text-ontology-preamble">
<p>
Use an ontology preamble, eg like this <code>otkg-preamble.ttl</code>.
Include all "system" prefixes that are shown after the newline (in particular, use <code>s:</code> instead of <code>schema:</code>)!
</p>
<div class="org-src-container">
<pre class="src src-ttl">@prefix otkg:   &lt;https://kg.ontotext.com/resource/ontology/&gt;.
@prefix s:      &lt;http://schema.org/&gt; .

@prefix dct:    &lt;http://purl.org/dc/terms/&gt; .
@prefix owl:    &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix rdf:    &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs:   &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix s:      &lt;http://schema.org/&gt; .
@prefix xsd:    &lt;http://www.w3.org/2001/XMLSchema#&gt; .

otkg: a owl:Ontology ;
  rdfs:label      "OTKG Ontology" ;
  dct:created     "2023-01-25"^^xsd:date ;
  dct:creator     &lt;http://ontotext.com&gt; ;
  owl:versionInfo "1.0" .
</pre>
</div>
</div>
</div>

<div id="outline-container-tsv2owl-options" class="outline-4">
<h4 id="tsv2owl-options">tsv2owl Options</h4>
<div class="outline-text-4" id="text-tsv2owl-options">
<p>
It has these options. 
</p>
<ul class="org-ul">
<li><p>
<code>-v</code>: default namespace for classes and props that don't have a specific URL in the RDF column.
</p>
<ul class="org-ul">
<li>By default is the empty prefix <code>:</code> (you must define this prefix in the preamble).</li>
</ul>
<p>
For example, for the Ontotext KG (OTKG), we use  <code>-v s: -o otkg:</code> i.e. schema.org (s:) as vocabulary namespace but otkg: as the ontology URL. Then eg:
</p>
<ul class="org-ul">
<li><code>keywords</code> will be emitted as <code>s:keywords</code> because it doesn't have an RDF value</li>
<li><code>buyersJourney</code> will be emitted as <code>otkg:buyersJourney</code> because that is its RDF value</li>
</ul></li>
<li><code>-o:</code>: ontology URL (optional).
<ul class="org-ul">
<li>Should match the <code>owl:Ontology</code> that you use in the preamble</li>
<li>Can be a prefixed URL (eg <code>otkg:</code>, in this case the URL has a slash at the end)
or a full URL (eg <a href="https://kg.ontotext.com/resource/ontology">https://kg.ontotext.com/resource/ontology</a> without slash at the end)</li>
<li>For each term (class and prop), adds <code>rdfs:isDefinedBy</code> pointing to the ontology.
This is a common practice and is used eg by MetaPhactory when collecting properties to generate forms.</li>
<li>Adds the current date as <code>dct:modified</code> of the ontology</li>
</ul></li>
<li><code>-t</code>: add <code>rdfs:range owl:Thing</code> to props with range <code>iri</code>
(this is needed for Metaphactory to be able to edit "free URLs").
<ul class="org-ul">
<li>Without this option, they are still mapped to <code>owl:ObjectProperty</code>, but without any <code>rdfs:range</code>.</li>
</ul></li>
<li><code>-l</code>: downgrade literal datatypes.
<ul class="org-ul">
<li>Datatypes are mapped as follows:</li>
</ul></li>
</ul>
<pre class="example">
langString            rdf:langString
stringOrLangString    rdf:langString
literal               rdf:Literal
dateOrYearOrMonth     xsd:date
dateOrTimeOrTimeStamp xsd:dateTimeStamp
&lt;datatype&gt;            xsd:&lt;datatype&gt;
</pre>
<ul class="org-ul">
<li>With this option, the following downgrading (simplification) is also done:</li>
</ul>
<pre class="example">
rdf:langString        xsd:string
rdf:Literal           xsd:string
</pre>
</div>
</div>

<div id="outline-container-tsv2owl-columns-and-features" class="outline-4">
<h4 id="tsv2owl-columns-and-features">tsv2owl Columns and Features</h4>
<div class="outline-text-4" id="text-tsv2owl-columns-and-features">
<p>
The tool uses the following sheet columns:
</p>
<ul class="org-ul">
<li><code>Class/prop</code>: class (if capitalized) or property belonging to the class above (if lowercase)</li>
<li><code>label</code>: emits <code>rdfs:label</code>, by default same as the first column</li>
<li><code>Inherits/range</code>: superclass (if it's a class row) or property range</li>
<li><code>char</code>: SOML characteristics:
<ul class="org-ul">
<li>Class: <code>kind, typeProp, name, search</code>: ignored
<ul class="org-ul">
<li>If it's <code>kind: abstract</code>, you'll want to use <code>RDF Replacement</code> (see below)</li>
</ul></li>
<li>Prop:
<ul class="org-ul">
<li><code>inverseAlias</code>: this is a  virtual property, so it's omitted</li>
<li><code>min, max</code>: mapped to <code>owl:minCardinality, owl:maxCardinality</code> restrictions on the containing class
(but see <a href="https://github.com/VladimirAlexiev/soml/issues/1">https://github.com/VladimirAlexiev/soml/issues/1</a> for unimplemented features)</li>
<li><code>inverseOf</code> (prop with or without namespace): mapped to <code>owl:inverseOf</code></li>
<li><code>symmetric</code> (only "true"): mapped to <code>owl:SymmetricProperty</code></li>
<li><code>subPropertyOf</code>: mapped to <code>rdfs:subPropertyOf</code></li>
<li><code>transitiveOver</code>: mapped to <code>psys:transitiveOver</code></li>
<li><code>search: {...}</code>: ignored</li>
<li>Not yet handled: <code>owl:FunctionalProperty</code></li>
</ul></li>
</ul></li>
<li><code>RDF</code>: RDF URL used for this class/prop. By default is uses the first column</li>
<li><code>(regex|pattern)</code>: ignored (these are used by SOML only)</li>
<li><code>descr</code>: emits <code>rdfs:comment</code></li>
<li><code>RDF replacement</code>: optional. See next section</li>
</ul>

<p>
Features and limitations:
</p>
<ul class="org-ul">
<li>Prop definitions (characteristics, label, descr, range; but not cardinality)
must conform in each use of a property.
This is not checked !!!
Use <code>riot --formatted ttl</code> to collect them in "paragraphs"
so you can check whether you have consistent definitions.</li>
<li>Emits <code>a rdfs:Class, owl:Class</code> for each class</li>
<li>Emits <code>s:domainIncludes</code> for each prop to accommodate props used several times.
You have an option to convert this to <code>rdfs:domain</code> for props that have a single domain.</li>
<li>Emits type <code>owl:ObjectProperty</code> vs <code>owl:DatatypeProperty</code> for each prop, depending on range:
<ul class="org-ul">
<li>If <code>iri</code> then <code>ObjectProperty</code>
(and with option <code>-t</code>, add <code>rdfs:range owl:Thing</code>)</li>
<li>If lowercase then <code>DatatypeProperty</code> (and prepend <code>xsd:</code> to the range)</li>
<li>Else (the range is a class) then <code>ObjectProperty</code></li>
</ul></li>
<li>Map only the data ranges indicated above: currently doesn't support <code>rdf:HTML, sysont:Markdown</code></li>
<li>Comment lines start with hash (<code>#</code>) in the first column
<ul class="org-ul">
<li><code># HEADER</code>: if there is a space after the hash, the first cell is printed surrounded by newlines</li>
<li><code>#commented out</code>: if there is no space, the whole line is skipped</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-rdf-replacement" class="outline-4">
<h4 id="rdf-replacement">RDF Replacement</h4>
<div class="outline-text-4" id="text-rdf-replacement">
<p>
The column <code>RDF</code> is used when you need to specify something different from <code>Class/name</code>.
Eg if you have this in the SOML preamble:
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #a0522d;">prefixes</span>:
  <span style="color: #a0522d;">vocab_iri</span>: http://schema.org/
  <span style="color: #a0522d;">vocab_prefix</span>: s
</pre>
</div>
<p>
The following tabular schema excerpt (leading dashes indicate the class hierarchy):
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Class/prop</th>
<th scope="col" class="org-left">range/inherits</th>
<th scope="col" class="org-left">RDF</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Event</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-EventSeries</td>
<td class="org-left">Event</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-EventParticipation</td>
<td class="org-left">Event</td>
<td class="org-left">otkg:EventPartcipation</td>
</tr>
</tbody>
</table>
<p>
generates <code>s:Event</code>, <code>s:EventSeries</code> and <code>otkg:EventPartcipation</code> respectively.
</p>

<p>
Semantic Objects currently supports only abstract superclasses,
so if we want to use all 3 classes with instance data, 
we need to add an abstract parent like this:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Class/prop</th>
<th scope="col" class="org-left">range/inherits</th>
<th scope="col" class="org-left">char</th>
<th scope="col" class="org-left">RDF</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">kind: abstract</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-Event</td>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-EventSeries</td>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-EventParticipation</td>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">otkg:EventPartcipation</td>
</tr>
</tbody>
</table>

<p>
It's quite common for one of the children (in this case <code>Event</code>) not to have any props of its own, 
just to inherit the props of the parent.
</p>

<p>
This works fine for <code>tsv2soml</code>, but <code>tsv2owl</code> would generate a parasitic (non-existent) RDF class <code>s:EventCommon</code>.
I thought of using the value <code>RDF: none</code> to signal that such class should be omitted.
But then I'd need to carry over the properties and parent of that parasitic class to one of its children (in this case <code>Event</code>).
</p>

<p>
So instead, I add an extra column <code>RDF replacement</code> that indicates which RDF class is used instead of the parasitic class:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Class/prop</th>
<th scope="col" class="org-left">range/inherits</th>
<th scope="col" class="org-left">char</th>
<th scope="col" class="org-left">RDF</th>
<th scope="col" class="org-left">RDF replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">kind: abstract</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Event</td>
</tr>

<tr>
<td class="org-left">-Event</td>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-EventSeries</td>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-EventParticipation</td>
<td class="org-left">EventCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">otkg:EventPartcipation</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
This replaces all references to <code>EventCommon</code> with <code>Event</code>: domain (prop attachment), range (prop target), superclass (parent), subclasses (children).
</p>

<p>
Notes:
</p>
<ul class="org-ul">
<li>It uses the fact that RDFS/OWL triples can be emitted in any order</li>
<li>It emits an extra reflexive triple <code>s:Event rdfs:subClassOf s:Event</code>, which is harmless and in fact is part of the RDFS semantics</li>
<li>It uses the RDF expression of the replacement class: in this case <code>s:Event</code> because the <code>RDF</code> column is not used, but you can specify something else in <code>RDF</code></li>
<li><code>label</code> and <code>descr</code> of the parasitic class are ignored to avoid emitting multiple labels/descriptions for the replacement class</li>
</ul>

<p>
You can also use replacement on leaf-level classes.
Consider the following example from OTKG (two leading dashes indicate the properties attached to the prev class):
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Class/prop</th>
<th scope="col" class="org-left">range/inherits</th>
<th scope="col" class="org-left">char</th>
<th scope="col" class="org-left">RDF</th>
<th scope="col" class="org-left">RDF replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Concept</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">name: prefLabel, kind: abstract</td>
<td class="org-left">skos:Concept</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#x2013;prefLabel</td>
<td class="org-left">string</td>
<td class="org-left">min: 1</td>
<td class="org-left">skos:prefLabel</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#x2013;inScheme</td>
<td class="org-left">ConceptScheme</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">skos:inScheme</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-Audience</td>
<td class="org-left">Concept</td>
<td class="org-left">typeProp: inScheme</td>
<td class="org-left">OTKG:audience</td>
<td class="org-left">skos:Concept</td>
</tr>

<tr>
<td class="org-left">-ContentType</td>
<td class="org-left">Concept</td>
<td class="org-left">typeProp: inScheme</td>
<td class="org-left">OTKG:contentType</td>
<td class="org-left">skos:Concept</td>
</tr>

<tr>
<td class="org-left">&#x2013;appliesToClass</td>
<td class="org-left">iri</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">otkg:appliesToClass</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PersonCommon</td>
<td class="org-left">Thing</td>
<td class="org-left">kind: abstract</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Person</td>
</tr>

<tr>
<td class="org-left">&#x2013;jobTitle</td>
<td class="org-left">string</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#x2013;worksFor</td>
<td class="org-left">Organization</td>
<td class="org-left">min: 1</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#x2013;sameAs</td>
<td class="org-left">iri</td>
<td class="org-left">max: inf</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-Person</td>
<td class="org-left">PersonCommon</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">-OntotextPerson</td>
<td class="org-left">PersonCommon</td>
<td class="org-left">typeProp: worksFor</td>
<td class="org-left">OTKG-agent:Ontotext</td>
<td class="org-left">none</td>
</tr>

<tr>
<td class="org-left">&#x2013;sameAs</td>
<td class="org-left">iri</td>
<td class="org-left">min: 1</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
Several sub-classes have an additional type discriminator designated by <code>typeProp</code> (in addition to the standard <code>rdf:type</code>):
</p>
<ul class="org-ul">
<li><code>ContentType</code> is a <code>skos:Concept</code> that is further distinguished by <code>skos:inScheme</code>.
It has extra prop <code>otkg:appliesToClass</code>, so we specify <code>replacement=skos:Concept</code> to carry over this prop to that parent class.
Note: this prop indicates which concept goes with which Schema class, eg <code>OTKG:contentType/blog_post</code> goes with <code>s:BlogPosting</code></li>
<li><code>Audience</code> adds no props compared to <code>Concept</code>, but we still set <code>replacement=skos:Concept</code>
to ensure that its incoming link <code>s:audience</code> will obtain <code>range=skos:Concept</code></li>
<li><code>PersonCommon</code> is a parasitic (abstract) parent class, so we replace it with <code>Person</code> (which is emitted in RDF as <code>s:Person</code>).
We already such replacement case in the previous example.</li>
<li><code>OntotextPerson</code> is a class that is the same as <code>Person</code>, but with fixed <code>s:worksFor=OTKG-agent:Ontotext</code>
and with stronger information requirements (we demand that it has at least one <code>s:sameAs</code>, the default in <code>Person</code> is <code>min: 0</code>).
There's neither RDF class <code>s:OntotextPerson</code> nor <code>otkg:OntotextPerson</code>, and it doesn't add any extra prop.
So we use <code>replacement=none</code> to omit it from RDF altogether.</li>
</ul>
</div>
</div>

<div id="outline-container-running-tsv2owl" class="outline-4">
<h4 id="running-tsv2owl">Running tsv2owl</h4>
<div class="outline-text-4" id="text-running-tsv2owl">
<p>
You can run the tool with a <code>Makefile</code> like this (see <a href="./tsv2owl">tsv2owl</a>), feeding from a Google Sheet:
</p>
<div class="org-src-container">
<pre class="src src-Makefile">ontology.ttl ::
	curl -Ls "https://docs.google.com/spreadsheets/d/.../export?format=tsv" | \
	  perl -S tsv2owl.pl -vocab s: -ontology otkg: | \
	  cat ontology-preamble.ttl - &gt; ontology-unformatted.ttl
	riot --formatted=ttl ontology-unformatted.ttl | \
   perl -00e '@a=&lt;&gt;; print sort @a' &gt; ontology.ttl
	# rm ontology-unformatted.ttl # keep for debugging
</pre>
</div>

<p>
The tool attaches props to classes using two ways: <code>s:domainIncludes</code> and <code>owl:Restriction</code>:
</p>
<div class="org-src-container">
<pre class="src src-turtle"><span style="color: #228b22;">s:</span><span style="color: #008b8b;">legalName</span>  <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;">type</span>     <span style="color: #228b22;">owl:</span><span style="color: #008b8b;">DatatypeProperty</span> ;
        <span style="color: #228b22;">s:</span><span style="color: #008b8b;">domainIncludes</span>  <span style="color: #228b22;">s:</span><span style="color: #008b8b;">Organization</span> ;
        <span style="color: #228b22;">s:</span><span style="color: #008b8b;">rangeIncludes</span>   <span style="color: #228b22;">xsd:</span><span style="color: #008b8b;">string</span> <span style="color: #228b22;">.</span>
<span style="color: #228b22;">s:</span><span style="color: #008b8b;">Organization</span>  <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;">type</span>  <span style="color: #228b22;">owl:</span><span style="color: #008b8b;">Class</span> , <span style="color: #228b22;">rdfs:</span><span style="color: #008b8b;">Class</span> ;
        <span style="color: #228b22;">rdfs:</span><span style="color: #008b8b;">subClassOf</span>   [ <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;">type</span>            <span style="color: #228b22;">owl:</span><span style="color: #008b8b;">Restriction</span> ;
                            <span style="color: #228b22;">owl:</span><span style="color: #008b8b;">maxCardinality</span>  1 ;
                            <span style="color: #b22222;"># owl:allValuesFrom xsd:string</span>
                            <span style="color: #228b22;">owl:</span><span style="color: #008b8b;">onProperty</span>      <span style="color: #228b22;">s:</span>legalName
                          ] .
</pre>
</div>
<p>
Metaphactory also needs the commented-out statement (<code>allValuesFrom</code> pointing to the property range).
To add that, use the SPARQL update <code>tsv2owl-allValuesFrom.ru</code>.
Replace <code>riot</code> with <code>update</code> (which is also part of Jena):
</p>
<div class="org-src-container">
<pre class="src src-Makefile">ontology.ttl ::
	curl -Ls "https://docs.google.com/spreadsheets/d/.../export?format=tsv" | \
	  perl -S tsv2owl.pl -vocab s: -ontology otkg: | \
	  cat ontology-preamble.ttl - &gt; ontology-unformatted.ttl
	update --update=../bin/tsv2owl-allValuesFrom.ru --data=ontology-unformatted.ttl --dump | \
   perl -00e '@a=&lt;&gt;; print sort @a' &gt; ontology.ttl
	# rm ontology-unformatted.ttl # keep for debugging
</pre>
</div>

<p>
The tool emits <code>s:domain/rangeIncludes</code> (which are polymorphic, i.e. multi-valued).
If you need to emit <code>rdfs:domain/range</code> (which are monomorphic, i.e. single-valued),
use the SPARQL update <code>tsv2owl-domain-range.ru</code> that does this:
</p>
<ul class="org-ul">
<li>If a prop has a single <code>s:domainIncludes</code>, convert it to <code>rdfs:domain</code></li>
<li>If a prop has a single <code>s:rangeIncludes</code>, convert it to <code>rdfs:range</code></li>
</ul>
<div class="org-src-container">
<pre class="src src-Makefile">ontology.ttl ::
	curl -Ls "https://docs.google.com/spreadsheets/d/.../export?format=tsv" | \
	  perl -S tsv2owl.pl -vocab s: -ontology otkg: | \
	  cat ontology-preamble.ttl - &gt; ontology-unformatted.ttl
	update --update=../bin/tsv2owl-domain-range.ru --data=ontology-unformatted.ttl --dump | \
   perl -00e '@a=&lt;&gt;; print sort @a' &gt; ontology.ttl
	# rm ontology-unformatted.ttl # keep for debugging
</pre>
</div>

<p>
You can diff <code>otkg.ttl</code> with <code>otkg-allValuesFrom.ttl</code> and  <code>otkg-domain-range.ttl</code> to see the difference.
</p>
</div>
</div>
</div>

<div id="outline-container-soml2puml" class="outline-3">
<h3 id="soml2puml">soml2puml</h3>
<div class="outline-text-3" id="text-soml2puml">
<p>
Generate nice PlantUML diagrams from SOML models.
See its own README.
</p>
</div>
</div>
</div>

<div id="outline-container-tricky-points-and-deficiencies" class="outline-2">
<h2 id="tricky-points-and-deficiencies">Tricky Points and Deficiencies</h2>
<div class="outline-text-2" id="text-tricky-points-and-deficiencies">
</div>

<div id="outline-container-graphql-type-vs-rdf-type" class="outline-3">
<h3 id="graphql-type-vs-rdf-type">GraphQL Type vs rdf:type</h3>
<div class="outline-text-3" id="text-graphql-type-vs-rdf-type">
</div>
</div>

<div id="outline-container-single-vs-multiple-value-props" class="outline-3">
<h3 id="single-vs-multiple-value-props">Single vs Multiple-Value Props</h3>
<div class="outline-text-3" id="text-single-vs-multiple-value-props">
</div>
</div>

<div id="outline-container-inverse-aliases" class="outline-3">
<h3 id="inverse-aliases">Inverse Aliases</h3>
<div class="outline-text-3" id="text-inverse-aliases">
</div>
</div>

<div id="outline-container-literals" class="outline-3">
<h3 id="literals">Literals</h3>
<div class="outline-text-3" id="text-literals">
<p>
(langString, union datatypes)
</p>
</div>
</div>

<div id="outline-container-extended-pattern-prefix-regex" class="outline-3">
<h3 id="extended-pattern-prefix-regex">Extended Pattern (Prefix + Regex)</h3>
<div class="outline-text-3" id="text-extended-pattern-prefix-regex">
</div>
</div>

<div id="outline-container-iri-generation" class="outline-3">
<h3 id="iri-generation">IRI Generation</h3>
<div class="outline-text-3" id="text-iri-generation">
</div>
</div>

<div id="outline-container-schema-inclusion-modularity" class="outline-3">
<h3 id="schema-inclusion-modularity">Schema Inclusion/Modularity</h3>
<div class="outline-text-3" id="text-schema-inclusion-modularity">
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="creator">Exported by Emacs 26.1 (Org mode 9.2.2)</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
